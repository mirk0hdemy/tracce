<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <title>TRACCE</title>
    <!-- Icona del sito -->
    <link rel="icon" type="image/png" href="assets/images/saturn-icon.png">
    <!-- Meta tag per la responsività, essenziale per adattare il contenuto alla larghezza del dispositivo -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Google Material Symbols per le icone e Font Orbit per il testo -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400&family=Orbit&display=swap" rel="stylesheet" />

    <style>
        /* Stili globali e reset per garantire una base pulita su tutti i browser */
        * {
            -webkit-tap-highlight-color: transparent; /* Rimuove l'evidenziazione al tocco su dispositivi mobili */
            box-sizing: border-box; /* Include padding e border nella larghezza/altezza totale dell'elemento */
        }

        body {
            background-color: black; /* Sfondo nero */
            color: white; /* Colore del testo bianco */
            font-family: 'Orbit', sans-serif; /* Utilizzo del font Orbit */
            display: flex;
            flex-direction: column; /* Sempre in colonna per il centraggio generale */
            justify-content: center; /* Centra verticalmente il contenuto */
            align-items: center; /* Centra orizzontalmente il contenuto */
            height: 100vh; /* Il body occupa l'intera altezza della viewport */
            margin: 0;
            padding: 20px; /* Padding generale per evitare che il contenuto tocchi i bordi su schermi piccoli */
            touch-action: manipulation; /* Migliora la reattività al tocco su touchscreens */
            overflow: hidden; /* Previene scrollbar indesiderate */
            position: relative;
        }

        /* Il video di sfondo a schermo intero non è più necessario */
        #background-video {
            display: none; /* Nasconde il video di sfondo a schermo intero */
        }

        /* Contenitore principale del layout */
        .main-content {
            display: flex;
            flex-direction: column; /* Contenuto impilato verticalmente */
            align-items: center;
            justify-content: center; /* Centra il contenuto principale */
            gap: 1.5rem; /* Spazio tra gli elementi */
            max-width: 90%;
            width: min(90vw, 400px); /* Larghezza massima per mobile/desktop piccoli */
            height: auto;
            max-height: calc(100vh - 40px);
            padding: 0;
            margin-top: 0;
            z-index: 1; /* Assicura che sia sopra eventuali sfondi */
        }

        /* Area di visualizzazione del "pianeta" (ora il video nel cerchio) */
        .planet-display-area {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Stili per il contenitore del video (ex immagine del pianeta) */
        .planet-image-container {
            position: relative;
            width: min(80vw, 350px); /* Dimensione base per mobile/desktop piccoli */
            height: min(80vw, 350px);
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.1s ease-out;
            animation: rotate360 20s linear infinite; /* Animazione di rotazione continua */
            animation-play-state: running; /* Assicura che l'animazione sia sempre attiva */
            background: radial-gradient(circle at center, #00008B 0%, #00005C 100%); /* Sfondo di fallback */
            will-change: transform; /* SUGGERIMENTO: Aggiunto per migliorare la fluidità dell'animazione */
        }

        /* Stili del cerchio nero centrale (foro del CD) */
        .cd-hole {
            width: 25px;
            height: 25px;
            background-color: black;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Stili per il link del cerchio centrale */
        .cd-hole-link {
            position: absolute;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            display: block;
            text-decoration: none;
            color: inherit;
            cursor: pointer;
        }

        /* Stile per il cerchio con bordo */
        .cd-ring {
            position: absolute;
            width: 75px;
            height: 75px;
            background: none;
            border: 2px solid black;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 11; /* Assicura che sia sopra il video e il cd-hole */
        }

        /* Stili del video all'interno del contenitore del pianeta */
        #planetVideo { /* Modificato da #planetImage a #planetVideo */
            width: 100%;
            height: 100%;
            object-fit: cover; /* Assicura che il video riempia il cerchio mantenendo le proporzioni */
            display: block;
        }

        /* Animazione di rotazione per il contenitore del video */
        @keyframes rotate360 {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Nuovo wrapper per i controlli del player e il testo della traccia */
        .player-controls-and-info {
            display: flex;
            flex-direction: column; /* Controlli e testo impilati verticalmente */
            align-items: center; /* Centra gli elementi all'interno di questa colonna */
            gap: 1.5rem; /* Spazio tra controls-wrapper e track-info-text */
        }

        /* Contenitore per i bottoni di controllo */
        .controls-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.2rem; /* Spazio tra i bottoni */
        }

        /* Stile base per tutti i bottoni del player */
        button {
            all: unset; /* Rimuove tutti gli stili di default del browser */
            display: flex;
            justify-content: center;
            align-items: center;
            background: none;
            cursor: pointer;
            transition: transform 0.1s ease-out, background-color 0.2s ease, border-color 0.2s ease;
            position: relative;
        }

        /* Rimuovi l'effetto ripple per mantenere il minimalismo */
        button:active::before {
            content: none;
        }

        /* Stili del bottone Play/Pausa con frosted glass */
        .play-pause-button {
            width: 80px; 
            height: 80px; 
            border-radius: 50%; 
            border: 1px solid rgba(255, 255, 255, 0.1); /* Bordo semi-trasparente, opacità ridotta */
            background-color: rgba(255, 255, 255, 0.02); /* Sfondo semi-trasparente, opacità ridotta */
            backdrop-filter: blur(5px); /* Effetto frosted glass */
            box-shadow: none; 
        }

        .play-pause-button:hover {
            transform: scale(1.05); 
            background-color: rgba(255, 255, 255, 0.05); /* Sfondo leggermente più opaco all'hover, opacità ridotta */
            box-shadow: none; 
        }

        .play-pause-button svg {
            width: 40px; 
            height: 40px; 
            fill: white; 
        }

        /* Stili per i bottoni disabilitati */
        button:disabled {
            opacity: 0.4; 
            cursor: not-allowed;
            border-color: gray;
            background: none;
            box-shadow: none;
            color: gray; /* Per Material Symbols */
        }

        /* Assicurati che l'icona SVG nei bottoni disabilitati sia grigia */
        button:disabled svg {
            fill: gray;
        }

        /* Stili dei bottoni di navigazione (Precedente/Successivo) e Shuffle/Loop con frosted glass */
        .nav-button,
        .shuffle-button,
        .loop-button {
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            color: white; 
            font-size: 1.8rem; 
            background-color: rgba(255, 255, 255, 0.02); /* Sfondo semi-trasparente, opacità ridotta */
            border: 1px solid rgba(255, 255, 255, 0.1); /* Bordo semi-trasparente, opacità ridotta */
            backdrop-filter: blur(5px); /* Effetto frosted glass */
            box-shadow: none; 
        }

        /* Hover states per desktop */
        .nav-button:hover,
        .shuffle-button:hover,
        .loop-button:hover {
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.05); /* Sfondo leggermente più opaco all'hover, opacità ridotta */
            color: white;
            box-shadow: none; 
            border-color: white;
        }

        /* Stili specifici per il pallino di attivazione (shuffle e loop) */
        .shuffle-button.active::after,
        .loop-button.active::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background-color: white;
            border-radius: 50%;
            bottom: -5px; /* Posiziona il pallino 5px sotto il bordo inferiore del bottone */
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
            display: block;
        }

        /* Nascondi il pallino quando il bottone non è attivo */
        .shuffle-button:not(.active)::after,
        .loop-button:not(.active)::after {
            display: none;
        }

        /* Stili specifici per il pulsante Shuffle attivo (no border, no background) */
        .shuffle-button.active {
            border: 1px solid transparent;
            background-color: transparent;
        }
        /* Stili specifici per il pulsante Loop attivo (no border, no background) */
        .loop-button.active {
            border: 1px solid transparent;
            background-color: transparent;
        }

        /* Stili per il testo "traccia_013" */
        .track-info-text {
            font-size: 1.2rem;
            text-transform: lowercase;
            color: white;
            margin-top: 0; 
            margin-bottom: 0;
            letter-spacing: 0.05em;
            font-weight: 400;
            text-align: center;
        }

        /* Media queries per la responsività sui dispositivi mobili (orientamento verticale) */
        @media (max-width: 768px) {
            body {
                justify-content: flex-start; /* Allinea il contenuto in alto per posizionamento preciso */
                padding: 0; /* Rimuovi padding dal body per gestione interna */
            }
            .main-content {
                width: min(90vw, 475px);
                height: 100vh; /* Occupo tutta l'altezza per distribuire elementi */
                max-height: 100vh; /* Previene lo scrolling verticale */
                gap: 0; /* Rimuovi il gap qui per lasciare space-between fare il suo lavoro */
                padding-top: 12vh; /* Video a 12% dal top */
                padding-bottom: 20vh; /* Player a 20% dal bottom */
                justify-content: space-between; /* Spingi elementi ai bordi del main-content */
                box-sizing: border-box; /* Assicura che padding sia incluso nell'altezza */
            }

            .planet-image-container {
                /* Calcola dimensione massima in base allo spazio verticale disponibile */
                width: min(90vw, 475px, calc(68vh * 0.8)); 
                height: min(90vw, 475px, calc(68vh * 0.8)); 
            }

            .player-controls-and-info {
                margin-top: 0; /* Rimuovi eventuali margini che potrebbero interferire */
                gap: 1rem;
                max-height: calc(68vh * 0.2); /* Limita altezza a 20% dello spazio disponibile */
            }

            /* --- STILI SPECIFICI MOBILE: NESSUNO SFONDO/BORDO PER HOVER/ACTIVE TRANNE PLAY/PAUSA --- */

            /* Rimuove gli effetti hover/active su tutti i bottoni sui dispositivi touch tranne play/pausa */
            button:hover:not(.play-pause-button):not([disabled]),
            button:active:not(.play-pause-button):not([disabled]) { 
                transform: scale(1) !important;
                background-color: rgba(255, 255, 255, 0.02) !important; /* Mantiene un minimo di background per coerenza con frosted glass */
                box-shadow: none !important;
                border-color: rgba(255, 255, 255, 0.1) !important; /* Mantiene il bordo per coerenza */
            }

            .play-pause-button:hover:not([disabled]) { 
                border-color: rgba(255, 255, 255, 0.1); 
                background-color: rgba(255, 255, 255, 0.02); 
                transform: scale(1.05); 
            }
            .play-pause-button:active:not([disabled]) { 
                background-color: rgba(255, 255, 255, 0.05) !important; 
                border-color: white !important; 
                transform: scale(1.05);
            }
        }

        @media (min-width: 769px) {
            body {
                justify-content: center; /* Mantiene il centraggio verticale per il body su desktop */
                flex-direction: column;
                padding: 20px; /* Ripristina il padding per desktop */
            }

            .main-content {
                flex-direction: row; /* Layout orizzontale per desktop */
                justify-content: center;
                align-items: center;
                gap: 5rem;
                max-width: 1200px;
                width: 95vw;
                height: 80vh; /* Altezza fissa per lasciare spazio sopra/sotto */
                max-height: 80vh; /* Assicura che non superi l'80% dell'altezza della viewport */
                padding: 0;
                margin-top: 0; /* Assicura che non ci sia un margin-top indesiderato da mobile */
            }

            .planet-image-container {
                width: min(550px, 80vh); /* Si adatta all'altezza della viewport ma max 550px */
                height: min(550px, 80vh); /* Si adatta all'altezza della viewport ma max 550px */
            }

            .player-controls-and-info {
                align-items: flex-start;
                gap: 1.5rem;
                margin-top: 0; /* Reset margin-top per desktop */
            }
            
            /* Assicura che i margini specifici mobile siano azzerati su desktop se non desiderati */
            .controls-wrapper,
            .track-info-text {
                margin-top: 0 !important;
                margin-bottom: 0 !important;
            }

            /* Ripristina gli stati hover per desktop, in caso fossero stati forzati a transparent da mobile */
            .nav-button:hover,
            .shuffle-button:hover,
            .loop-button:hover {
                background-color: rgba(255, 255, 255, 0.1);
                border-color: white;
                transform: scale(1.1);
            }
            .play-pause-button:hover {
                background-color: rgba(255, 255, 255, 0.1);
                border-color: white;
                transform: scale(1.05);
            }
        }
    </style>
</head>
<body>

    <!-- Contenitore principale del layout -->
    <div class="main-content">
        <!-- Sezione del Pianeta (sinistra su desktop, alto su mobile) -->
        <div class="planet-display-area">
            <div class="planet-image-container">
                <!-- Sostituisco l'img con un video -->
                <video autoplay loop muted playsinline id="planetVideo">
                    <source src="https://assets.mixkit.co/videos/preview/mixkit-nebula-with-stars-1100-large.mp4" type="video/mp4">
                    Il tuo browser non supporta il tag video.
                </video>
                <!-- Aggiunto un link intorno al cerchio nero centrale -->
                <a href="bonus.html" class="cd-hole-link">
                    <div class="cd-hole"></div>
                </a>
                <div class="cd-ring"></div>
            </div>
        </div>

        <!-- Sezione Controlli Player e Info Traccia (destra su desktop, basso su mobile) -->
        <div class="player-controls-and-info">
            <div class="controls-wrapper">
                <!-- I pulsanti shuffle, precedente e successivo sono disabilitati per una singola traccia -->
                <button id="randomBtn" class="shuffle-button" disabled>
                    <span class="material-symbols-outlined">shuffle</span>
                </button>
                <button id="prevBtn" class="nav-button" disabled>
                    <span class="material-symbols-outlined">skip_previous</span>
                </button>
                <button id="toggleBtn" class="play-pause-button">
                    <svg id="icon" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                </button>
                <button id="nextBtn" class="nav-button" disabled>
                    <span class="material-symbols-outlined">skip_next</span>
                </button>
                <!-- Il pulsante loop è disabilitato in quanto la traccia audio si ripeterà all'infinito -->
                <button id="loopBtn" class="loop-button" disabled style="opacity: 0.4; cursor: not-allowed;">
                    <span class="material-symbols-outlined">loop</span>
                </button>
            </div>
            <p id="trackNumberDisplay" class="track-info-text"></p>
        </div>
    </div>

    <!-- Elemento audio HTML5 (posizionato fuori dal layout visivo principale) -->
    <audio id="myAudio">
        Il tuo browser non supporta l'audio.
    </audio>

    <script>
        // References to DOM elements
        const audio = document.getElementById('myAudio');
        const toggleBtn = document.getElementById('toggleBtn');
        const icon = document.getElementById('icon');
        const trackNumberDisplay = document.getElementById('trackNumberDisplay');
        const loopBtn = document.getElementById('loopBtn'); // Mantenuto il riferimento, ma il pulsante è disabilitato
        const planetVideo = document.getElementById('planetVideo'); // Riferimento al nuovo elemento video

        // Array di tracce audio (una sola per bonus.html)
        const tracks = [
            { title: 'traccia_013', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3' } 
        ];

        let currentTrackIndex = 0; // Rimane 0, unica traccia

        // Icone SVG per gli stati Play e Pause
        const playIcon = `<path d="M8 5v14l11-7z"/>`;
        const pauseIcon = `<path d="M6 19h4V5H6zm8-14v14h4V5h-4z"/>`;

        /**
         * Carica una traccia audio specificata dall'indice nell'array `tracks`.
         * Aggiorna il testo della traccia.
         * La rotazione del video è gestita solo dal CSS e non viene interrotta dal JS.
         * @param {number} index L'indice della traccia da caricare (sempre 0 in questo caso).
         * @param {boolean} shouldPlayAfterLoad Se true, la traccia verrà riprodotta automaticamente dopo il caricamento.
         */
        function loadTrack(index, shouldPlayAfterLoad = false) {
            if (!audio.paused) {
                audio.pause();
            }
            icon.innerHTML = playIcon;
            
            currentTrackIndex = index;
            audio.src = tracks[currentTrackIndex].src;
            // Non c'è più un'immagine del pianeta da impostare

            console.log("Tentativo di caricare audio da:", audio.src);

            trackNumberDisplay.textContent = tracks[currentTrackIndex].title; // Visualizza il titolo "traccia_013"
            audio.load();

            audio.onerror = (e) => {
                console.error("Errore di caricamento audio per la traccia:", tracks[currentTrackIndex].title, e);
                trackNumberDisplay.textContent = `Errore: "${tracks[currentTrackIndex].title}" non trovata o non supportata.`;
                toggleBtn.disabled = true;
                icon.innerHTML = playIcon;
            };

            audio.onloadedmetadata = () => {
                toggleBtn.disabled = false;
            };

            if (shouldPlayAfterLoad) {
                audio.play()
                    .then(() => {
                        icon.innerHTML = pauseIcon;
                    })
                    .catch(error => {
                        console.error("Errore durante l'avvio della riproduzione (potrebbe essere dovuto a policy browser o sorgente):", error);
                        icon.innerHTML = playIcon;
                    });
            }
        }

        // Event listener per il bottone Play/Pausa
        toggleBtn.addEventListener('click', () => {
            if (audio.paused) {
                audio.play()
                    .then(() => {
                        icon.innerHTML = pauseIcon;
                    })
                    .catch(error => {
                        console.error("Errore durante l'avvio della riproduzione:", error);
                        icon.innerHTML = playIcon;
                    });
            } else {
                audio.pause();
                icon.innerHTML = playIcon;
            }
        });

        // Event listener: quando una traccia finisce
        audio.addEventListener('ended', () => {
            // Poiché l'audio è sempre in loop, questa parte non sarà mai eseguita se audio.loop è true.
            // Tuttavia, se per qualche motivo il loop dovesse essere disattivato esternamente (es. da dev tools),
            // la traccia si ricaricherebbe e ripartirebbe.
            if (!audio.loop) {
                loadTrack(0, true); // Ricarica la stessa traccia e riprodurla
            }
        });

        // Inizializza il player con la singola traccia bonus al caricamento della pagina
        document.addEventListener('DOMContentLoaded', () => {
            audio.loop = true; // Imposta il loop audio su true per sempre
            loopBtn.classList.remove('active'); // Assicurati che l'indicatore visuale non sia attivo
            // Il pulsante loop è ora disabilitato nell'HTML, quindi non ha bisogno di un listener.

            loadTrack(0, false); // Carica la prima (e unica) traccia
        });
    </script>
</body>
</html>
